{"files":[{"id":"c142610e-0818-483a-a4b2-2d8e516472d5","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"560aa183-b374-400d-a9d9-f7ad26b92c4b","name":"EmailFinder","type":"server_js","source":"function doPost(e)\n{\n\n  if(typeof e \u003d\u003d \u0027undefined\u0027) \n    console.log(\u0027e \u003d\u003d undefined\u0027);\n  else if (e.parameter[\u0027processingStatus\u0027] \u003d\u003d \u0027processingUser\u0027)\n  {\n    var epar \u003d e.parameter.emailUser;\n    if (returnemail(epar) \u003d\u003d false)\n    {\n    setValueUserData(e.parameter.regDate, epar);\n    return ContentService.createTextOutput(JSON.stringify(getOrders(epar)));\n\n    }\n    else if (returnemail(epar) \u003d\u003d \"customer\")\n    return ContentService.createTextOutput(JSON.stringify(getOrders(epar)));\n    else if (returnemail(epar) \u003d\u003d \"manager\")\n    return ContentService.createTextOutput(JSON.stringify(getAllUsers()));\n  }\n  else if (e.parameter[\u0027processingStatus\u0027] \u003d\u003d \u0027sendAppData\u0027)\n  {\n    var email \u003d e.parameter.emailUser;\n    var appname \u003d e.parameter.applicationName;\n    var descr \u003d e.parameter.shortDescription;\n    var createDate \u003d e.parameter.creatingDateApp;\n    var endDate \u003d e.parameter.dateofEnding;\n\n    setValueAppData(email, appname, descr, createDate, endDate);\n    return ContentService.createTextOutput(JSON.stringify(getOrders(email)));\n  }\n  else if (e.parameter[\u0027processingStatus\u0027] \u003d\u003d \u0027changeAccess\u0027)\n  {\n    changeAccess(e.parameter.emailUser, e.parameter.access);\n    return ContentService.createTextOutput(JSON.stringify(getAllUsers()));\n\n  }\n}\n\nfunction setValueUserData(date, mail)\n{\n  var openbase \u003d SpreadsheetApp.openById(\u00271wz9y9gUamh3rnuS0dCU2MyXyu_pyi4sqYnt_89MlwY0\u0027);\n  var opensheet \u003d openbase.getSheetByName(\u0027Users\u0027);\n  var lastclearrow \u003d opensheet.getLastRow() + 1;\n  if (lastclearrow)\n  var key \u003d opensheet.getRange(\"A\"+lastclearrow).setValue(lastclearrow-1);\n  var em \u003d opensheet.getRange(\"B\"+lastclearrow).setValue(mail);\n  var su \u003d opensheet.getRange(\"C\"+lastclearrow).setValue(\u0027customer\u0027);\n  var rd \u003d opensheet.getRange(\"D\"+lastclearrow).setValue(date);\n  return true;\n}\n\nfunction setValueAppData(gmail, appName, description, creationDate, endingDate)\n{\n  var openbase \u003d SpreadsheetApp.openById(\u00271wz9y9gUamh3rnuS0dCU2MyXyu_pyi4sqYnt_89MlwY0\u0027);\n  var opensheet \u003d openbase.getSheetByName(\u0027Applications\u0027);\n \n  var lastclearrow \u003d opensheet.getLastRow() + 1;\n  var key \u003d opensheet.getRange(\"A\"+lastclearrow).setValue(lastclearrow-1);\n  var em \u003d opensheet.getRange(\"B\"+lastclearrow).setValue(gmail);\n  var an \u003d opensheet.getRange(\"C\"+lastclearrow).setValue(appName);\n  var sd \u003d opensheet.getRange(\"D\"+lastclearrow).setValue(description);\n  var ap \u003d opensheet.getRange(\"E\"+lastclearrow).setValue(\"not confirmed\");\n  var mi \u003d opensheet.getRange(\"F\"+lastclearrow).setValue(\"-\");\n  var cd \u003d opensheet.getRange(\"G\"+lastclearrow).setValue(creationDate);\n  var doc \u003d opensheet.getRange(\"H\"+lastclearrow).setValue(\"-\");\n  var ed \u003d opensheet.getRange(\"I\"+lastclearrow).setValue(endingDate);\n  return true;\n}\n\nfunction returnemail(email)\n{\n  var openbase \u003d SpreadsheetApp.openById(\u00271wz9y9gUamh3rnuS0dCU2MyXyu_pyi4sqYnt_89MlwY0\u0027);\n  var opensheet \u003d openbase.getSheetByName(\u0027Users\u0027);\n  \n  var row; \n  for(i \u003d 2; i \u003c\u003d opensheet.getLastRow(); i++)\n  {\n    row \u003d opensheet.getRange(\"B\"+i).getValue();\n    rowuserstat \u003d opensheet.getRange(\"C\"+i).getValue();\n    if (row \u003d\u003d email)\n    { \n      if (rowuserstat \u003d\u003d \"customer\")\n      return \"customer\";\n      else if (rowuserstat \u003d\u003d \"manager\")\n      return \"manager\";\n    }\n  }\n  return false;\n}\n\nfunction getOrders(email)\n{\n  var openbase \u003d SpreadsheetApp.openById(\u00271wz9y9gUamh3rnuS0dCU2MyXyu_pyi4sqYnt_89MlwY0\u0027);\n  var opensheet \u003d openbase.getSheetByName(\u0027Applications\u0027);\n  var setData \u003d new Object();\n  var sum \u003d 0;\n\n  for (i \u003d 2; i \u003c\u003d opensheet.getLastRow(); i++)\n  {\n    var str \u003d opensheet.getRange(\"B\" + i).getValue();\n    if (str \u003d\u003d email)\n    {\n      sum++;\n      setData[sum] \u003d {\n      \u0027orderNum\u0027 : sum,\n      \u0027orderName\u0027 : opensheet.getRange(\"C\"+i).getValue(),\n      \u0027description\u0027 : opensheet.getRange(\"D\"+i).getValue(),\n      \u0027orderStatus\u0027 : opensheet.getRange(\"E\"+i).getValue(),\n      \u0027executer\u0027 : opensheet.getRange(\"F\"+i).getValue(),\n      \u0027createDate\u0027 : opensheet.getRange(\"G\"+i).getValue(),\n      \u0027processDate\u0027 : opensheet.getRange(\"H\"+i).getValue(),\n      \u0027endingDate\u0027 : opensheet.getRange(\"I\"+i).getValue()\n      };\n    };\n  }\n\n    setData[\"sumorders\"] \u003d sum;\n    setData[\"userStatus\"] \u003d \"customer\";\n\n  return setData;\n}\n\nfunction getAllUsers()\n{\n  var openbase \u003d SpreadsheetApp.openById(\u00271wz9y9gUamh3rnuS0dCU2MyXyu_pyi4sqYnt_89MlwY0\u0027);\n  var opensheet \u003d openbase.getSheetByName(\u0027Users\u0027);\n  var allUsers \u003d new Object();\n  var sum \u003d 0;\n\n  for (i \u003d 2; i \u003c\u003d opensheet.getLastRow(); i++)\n  {\n      sum++;\n      allUsers[i-1] \u003d {\n      \u0027primarykey\u0027 : i-1,\n      \u0027gmail\u0027 : opensheet.getRange(\"B\"+i).getValue(),\n      \u0027userProcessingStatus\u0027 : opensheet.getRange(\"C\"+i).getValue(),\n      \u0027regDate\u0027 :  opensheet.getRange(\"D\"+i).getValue()\n      };  \n  }\n  allUsers[\"sumusers\"] \u003d sum;\n  allUsers[\"myUserStatus\"] \u003d \"manager\";\n\n  return allUsers;\n}\nfunction changeAccess(email, status)\n{\n  var openbase \u003d SpreadsheetApp.openById(\u00271wz9y9gUamh3rnuS0dCU2MyXyu_pyi4sqYnt_89MlwY0\u0027);\n  var opensheet \u003d openbase.getSheetByName(\u0027Users\u0027);\n\n  for (i \u003d 2; i \u003c\u003d opensheet.getLastRow(); i++)\n  {\n    var emailuser \u003d opensheet.getRange(\"B\"+i).getValue();\n    if (emailuser \u003d\u003d email)\n    {\n      var ca \u003d opensheet.getRange(\"C\"+i).setValue(status);\n      return true;\n    }\n\n  }\n\n}\n\n\n\n\n\n  //var ss \u003d SpreadsheetApp.openByUrl(\u0027https://docs.google.com/spreadsheets/d/1wz9y9gUamh3rnuS0dCU2MyXyu_pyi4sqYnt_89MlwY0/edit#gid\u003d0\u0027);\n  //var r \u003d ss.getLastRow();\n\n // Logger.log(returnemail(epar));\n  \n // var rr \u003d ss.getActiveSheet().getRange(\"A\"+(r+1)).setValue(returnemail(0));\n\n  //var rr \u003d ss.getActiveSheet().getRange(\"A\"+(r+1)).setValue(epar);\n  //var rs \u003d ss.getRange(\"A1\"+\":\"+\"A\"+r).getValues();\n\n // var rr \u003d ss.getActiveSheet().getRange(\"A\"+(r+1)).setValue(getEmail());\n  //var formattedDate \u003d Utilities.formatDate(new Date(), \"GMT\", \"yyyy-MM-dd\u0027T\u0027HH:mm:ss\u0027Z\u0027\");\n  //var rr1 \u003d ss.getActiveSheet().getRange(\"B\"+(r+1)).setValue(formattedDate);\n /* function testobj()\n  {\n    var ss \u003d SpreadsheetApp.openByUrl(\u0027https://docs.google.com/spreadsheets/d/1wz9y9gUamh3rnuS0dCU2MyXyu_pyi4sqYnt_89MlwY0/edit#gid\u003d0\u0027);\n    var r \u003d ss.getLastRow();\n    var rs \u003d ss.getRange(\"A1\"+\":\"+\"A\"+r).getValues();\n    Logger.log(JSON.stringify(rs));\n  }*/"}]}