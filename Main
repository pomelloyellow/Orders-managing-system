{"files":[{"id":"13031a39-637a-488e-9d29-e5d6d7d254a1","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_ACCESSING\",\n    \"access\": \"ANYONE\"\n  }\n}"},{"id":"994936fb-3016-4a21-a937-94b3113c858b","name":"Код","type":"server_js","source":"function doGet(e) {\n  if(typeof e \u003d\u003d \u0027undefined\u0027)\n  {\n    Logger.log(\u0027undefined\u0027);\n  }\n  else if(!e.parameter.pageApp)\n  {\n    var emailUser \u003d Session.getActiveUser().getEmail();\n    var regDate \u003d Utilities.formatDate(new Date(), \"GMT\", \"yyyy-MM-dd\u0027T\u0027HH:mm:ss\u0027Z\u0027\");\n\n    var formData \u003d {\n    \u0027emailUser\u0027: emailUser,\n    \u0027regDate\u0027 : regDate,\n    \u0027processingStatus\u0027: \u0027processingUser\u0027\n    };\n    \n    var options \u003d {\n    \u0027method\u0027 : \u0027post\u0027,\n    \u0027payload\u0027 : formData\n    };\n\n    var urlServer \u003d \"https://script.google.com/macros/s/AKfycby-fVF7Ucb2LjNfbUdMmcWZjeH_FTPtFxeTNT-RQxiMMV8Jn79hnGrsV6ag6BY6SNNm/exec\";\n\n    res \u003d UrlFetchApp.fetch(urlServer, options);\n    contentText \u003d res.getContentText();\n    parseContentText \u003d JSON.parse(contentText);\n    Logger.log(contentText);\n\n    if(parseContentText.userStatus \u003d\u003d \"customer\")\n    {\n        htmlOutput \u003d HtmlService.createTemplateFromFile(\u0027UserApplicationForm\u0027);\n        htmlOutput.url \u003d getURL();\n        htmlOutput.orders \u003d JSON.parse(contentText);\n        return htmlOutput.evaluate();\n    }\n    else if (parseContentText.myUserStatus \u003d\u003d \"manager\")\n    {\n        htmlOutput \u003d HtmlService.createTemplateFromFile(\u0027ManagerApplicationForm\u0027);\n        htmlOutput.url \u003d getURL();\n        htmlOutput.users \u003d JSON.parse(contentText);\n        return htmlOutput.evaluate();\n    }\n   /* else if(parseContentText.myUserStatus \u003d\u003d \"manager\")\n    {\n        htmlOutput \u003d HtmlService.createTemplateFromFile(\u0027ManagerApplicationForm\u0027);\n        htmlOutput.url \u003d getURL();\n        htmlOutput.users \u003d JSON.parse(contentText);\n        return htmlOutput.evaluate()\n    };*/\n  }\n  else if(e.parameter[\u0027pageApp\u0027] \u003d\u003d \u0027createnewapp\u0027)\n  {\n    Logger.log(e.parameter);\n    htmlOutput \u003d HtmlService.createTemplateFromFile(\u0027CreateApplicationForm\u0027);\n    htmlOutput.url \u003d getURL();\n    return htmlOutput.evaluate();\n  }\n  else if(e.parameter[\u0027pageApp\u0027] \u003d\u003d \u0027returnUserPage\u0027)\n  {\n\n    var emailUser \u003d Session.getActiveUser().getEmail();\n    var applicationName \u003d e.parameter.appName;\n    var shortdescription \u003d e.parameter.shortDescript;\n    var createDateApp \u003d Utilities.formatDate(new Date(), \"GMT\", \"yyyy-MM-dd\u0027T\u0027HH:mm:ss\u0027Z\u0027\");\n    var dateOfEnding \u003d e.parameter.date;\n\n    var appData \u003d {\n      \u0027emailUser\u0027 : emailUser,\n      \u0027applicationName\u0027 : applicationName,\n      \u0027shortDescription\u0027 : shortdescription,\n      \u0027creatingDateApp\u0027 : createDateApp,\n      \u0027dateofEnding\u0027 : dateOfEnding,\n      \u0027processingStatus\u0027 : \u0027sendAppData\u0027\n    }\n\n    var options \u003d {\n    \u0027method\u0027 : \u0027post\u0027,\n    \u0027payload\u0027 : appData\n    };\n\n    var urlServer \u003d \"https://script.google.com/macros/s/AKfycby-fVF7Ucb2LjNfbUdMmcWZjeH_FTPtFxeTNT-RQxiMMV8Jn79hnGrsV6ag6BY6SNNm/exec\";\n\n    res \u003d UrlFetchApp.fetch(urlServer, options);\n    responseCode \u003d res.getResponseCode(); \n    contentText \u003d res.getContentText();\n    Logger.log(contentText);\n\n    Logger.log(appData);\n    htmlOutput \u003d HtmlService.createTemplateFromFile(\u0027UserApplicationForm\u0027);\n    htmlOutput.url \u003d getURL();\n    htmlOutput.orders \u003d JSON.parse(contentText);\n    return htmlOutput.evaluate();\n  }\n else if (e.parameter[\u0027pageApp\u0027] \u003d\u003d \u0027changeAccess\u0027)\n  {\n    Logger.log(e.parameter);\n    if(e.parameter[\u0027accessManager\u0027]){\n    var changeAccessData \u003d \n    {\n      \u0027emailUser\u0027 : e.parameter[\u0027accessManager\u0027],\n      \u0027processingStatus\u0027 : \u0027changeAccess\u0027,\n      \u0027access\u0027 : \u0027manager\u0027\n    };}\n    else if (e.parameter[\u0027accessCustomer\u0027])\n    {\n    var changeAccessData \u003d \n    {\n      \u0027emailUser\u0027 : e.parameter[\u0027accessCustomer\u0027],\n      \u0027processingStatus\u0027 : \u0027changeAccess\u0027,\n      \u0027access\u0027 : \u0027customer\u0027\n    };\n    }\n    var options \u003d {\n      \u0027method\u0027 : \u0027post\u0027,\n      \u0027payload\u0027 : changeAccessData\n    };\n    var urlServer \u003d \"https://script.google.com/macros/s/AKfycby-fVF7Ucb2LjNfbUdMmcWZjeH_FTPtFxeTNT-RQxiMMV8Jn79hnGrsV6ag6BY6SNNm/exec\";\n    res \u003d UrlFetchApp.fetch(urlServer, options);\n        htmlOutput \u003d HtmlService.createTemplateFromFile(\u0027ManagerApplicationForm\u0027);\n        contentText \u003d res.getContentText();\n        Logger.log(contentText);\n      htmlOutput.url \u003d getURL();\n      htmlOutput.users \u003d JSON.parse(contentText);\n      return htmlOutput.evaluate();\n    \n\n\n  };\n}\n\nfunction getURL()\n{\n  var url \u003d ScriptApp.getService().getUrl();\n  return url;\n}"},{"id":"4e2a494c-576e-4d42-b2f2-74a587a0a8dd","name":"UserApplicationForm","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003c?\u003d orders ?\u003e\n    \u003cform action \u003d \"\u003c?\u003d url ?\u003e\" method \u003d \"GET\"\u003e\n       \u003ctable align \u003d \"center\"\u003e\n     \u003ctr\u003e\n       \u003cth\u003e№\u003c/th\u003e\n       \u003cth\u003eOrder name\u003c/th\u003e\n       \u003cth\u003eDescription\u003c/th\u003e\n       \u003cth\u003eStatus\u003c/th\u003e\n       \u003cth\u003eExecuter\u003c/th\u003e\n       \u003cth\u003eDate of creation\u003c/th\u003e\n       \u003cth\u003eDate of processing\u003c/th\u003e\n       \u003cth\u003eDate of ending\u003c/th\u003e\n     \u003c/tr\u003e\n     \u003c? for(i \u003d 1; i \u003c\u003d orders.sumorders; i++) { ?\u003e\n     \u003ctr\u003e\n       \u003ctd\u003e\u003c?\u003d i ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d orders[i].orderName ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d orders[i].description ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d orders[i].orderStatus ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d orders[i].executer ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d orders[i].createDate ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d orders[i].processDate ?\u003e\u003c/td\u003e\n       \u003ctd text-align\u003d\"left\"\u003e\u003c?\u003d orders[i].endingDate ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003cinput type \u003d \"submit\"  name \u003d\"sub\"\u003e\u003c/td\u003e\n     \u003c/tr\u003e  \n     \u003c? } ?\u003e\n   \u003c/table\u003e\n      \u003cinput type \u003d \"hidden\" name\u003d\"pageApp\" value \u003d \"createnewapp\"\u003e\n      \u003cinput type \u003d \"submit\" name \u003d \"subCreate\" value \u003d \"Create\"\u003e\n    \u003c/form\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"d302453d-190e-47b6-a0f9-1b6d066952d5","name":"CreateApplicationForm","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cform action \u003d \"\u003c?\u003d url ?\u003e\" method \u003d \"GET\"\u003e\n      \u003cinput type \u003d \"text\" name \u003d \"appName\"\u003e\n      \u003cinput type \u003d \"text\" name \u003d \"shortDescript\"\u003e\n      \u003cinput type \u003d \"date\" name \u003d \"date\"\u003e\n      \u003cinput type \u003d \"hidden\" name \u003d \"pageApp\" value \u003d \"returnUserPage\"\u003e\n      \u003cinput type \u003d \"submit\" name \u003d \"sub\" value \u003d \"create\"\u003e\n    \u003c/form\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"8ed4e613-faff-4ec4-b2e6-9011eeb7ff93","name":"ManagerApplicationForm","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003cstyle\u003e\n       th { \n    padding: 5px; /* Поля вокруг содержимого ячеек */\n    border: 1px solid black; \n       }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003c?\u003d users ?\u003e\n    \u003cform action \u003d \"\u003c?\u003d url ?\u003e\" method \u003d \"GET\"\u003e\n    \u003cinput type \u003d \"hidden\" name\u003d\"pageApp\" value \u003d \"changeAccess\"\u003e\n\n       \u003ctable align \u003d \"center\"\u003e\n     \u003ctr\u003e\n       \u003cth\u003e№\u003c/th\u003e\n       \u003cth\u003eGmail adress\u003c/th\u003e\n       \u003cth\u003eUser status\u003c/th\u003e\n       \u003cth\u003eRegistration date\u003c/th\u003e\n       \u003cth\u003eСustomer\u003c/th\u003e\n       \u003cth\u003eManager\u003c/th\u003e\n     \u003c/tr\u003e\n     \u003c? for(i \u003d 1; i \u003c\u003d users.sumusers; i++) { ?\u003e\n     \u003ctr\u003e\n       \u003ctd\u003e\u003c?\u003d i ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d users[i].gmail ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d users[i].userProcessingStatus ?\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003c?\u003d users[i].regDate ?\u003e\u003c/td\u003e\n       \u003c? if((users[i].gmail !\u003d Session.getActiveUser().getEmail())\u0026\u0026(users[i].userProcessingStatus !\u003d \"manager\")) { ?\u003e\n       \u003ctd\u003e\u003cinput type \u003d \"radio\" name \u003d \"accessCustomer\" value \u003d \"\u003c?\u003d users[i].gmail ?\u003e\"\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003cinput type \u003d \"radio\" name \u003d \"accessManager\" value \u003d \"\u003c?\u003d users[i].gmail ?\u003e\"\u003e\u003c/td\u003e\n       \u003ctd\u003e\u003cinput type \u003d \"submit\" name \u003d \"ChangeAccessSub\" value \u003d \"Change access\" \u003e\u003c/td\u003e\n       \u003c? } ?\u003e\n     \u003c/tr\u003e  \n     \u003c? } ?\u003e\n   \u003c/table\u003e\n    \u003c/form\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n"}]}